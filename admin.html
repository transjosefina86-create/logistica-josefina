<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Transporte La Josefina</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        /* FONDO NARANJA Y ESTÉTICA GENERAL */
        body { font-family: 'Arial', sans-serif; background: #ff6600; margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { background: white; padding: 30px; border-radius: 20px; width: 95%; max-width: 1200px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); text-align: center; align-self: flex-start; }
        
        /* LOGO ESTÉTICO */
        .logo-texto { font-family: 'Brush Script MT', cursive; font-size: 50px; color: #ff6600; text-shadow: 3px 3px 5px rgba(0,0,0,0.3); margin-bottom: 20px; display: block; }

        /* LOGIN */
        .pantalla-login { max-width: 400px; margin: auto; padding: 20px; }
        .pantalla-login input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; border: 2px solid #ddd; font-size: 18px; text-align: center; }

        /* SECCIONES Y RECUADROS (Tu estructura original) */
        .seccion { background: #f9f9f9; padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 1px solid #eee; text-align: left; }
        h3 { color: #ff6600; text-transform: uppercase; border-bottom: 2px solid #ff6600; padding-bottom: 5px; margin-top: 0; }

        .grid-formulario { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .grid-formulario input { padding: 10px; border-radius: 8px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; }

        /* TABLA Y FICHA DE CAMIÓN */
        .tabla-scroll { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; background: white; }
        th { background: #333; color: white; padding: 12px; font-size: 11px; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; vertical-align: middle; }

        .ficha-datos { font-size: 12px; line-height: 1.4; background: #fff; padding: 8px; border-radius: 8px; border: 1px solid #eee; }
        .ficha-datos b { color: #ff6600; }

        /* BOTONES */
        .btn-negro { background: #222; color: white; padding: 12px 25px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-pdf { background: #28a745; color: white; padding: 6px 12px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; }
        .btn-borrar { background: #dc3545; color: white; padding: 6px 12px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; }
        
        .oculto { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <span class="logo-texto">Transporte La Josefina</span>

        <div id="login-admin" class="pantalla-login">
            <input type="password" id="pass-admin" placeholder="CLAVE DE ACCESO">
            <button class="btn-negro" style="width:100%" onclick="entrarAdmin()">ENTRAR AL PANEL</button>
        </div>

        <div id="panel-datos" class="oculto">
            
            <div class="seccion">
                <h3>Administrar Flota y Claves</h3>
                <div class="grid-formulario">
                    <input type="text" id="add-n-camion" placeholder="N° Camión">
                    <input type="text" id="add-chasis" placeholder="Patente Chasis">
                    <input type="text" id="add-acoplado" placeholder="Patente Acoplado">
                    <input type="text" id="add-clave" placeholder="Clave Chofer">
                </div>
                <button class="btn-negro" onclick="guardarCamion()">REGISTRAR CAMIÓN</button>
            </div>

            <div class="seccion">
                <h3>Reportes de Viaje y Carga</h3>
                <div class="tabla-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>N° Camión</th>
                                <th>Ficha de Datos</th>
                                <th>Estado / Destino</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="lista-reportes"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC...", 
            authDomain: "control-logistica-2026.firebaseapp.com",
            projectId: "control-logistica-2026",
            appId: "1:389274295324:web:04467597157833633e467d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function entrarAdmin() {
            if(document.getElementById('pass-admin').value === "1234") {
                document.getElementById('login-admin').classList.add('oculto');
                document.getElementById('panel-datos').classList.remove('oculto');
                cargarReportes();
            } else { alert("Clave Incorrecta"); }
        }

        // GUARDAR CAMIÓN (Función original que pediste mantener)
        function guardarCamion() {
            const n = document.getElementById('add-n-camion').value;
            const ch = document.getElementById('add-chasis').value.toUpperCase();
            const ac = document.getElementById('add-acoplado').value.toUpperCase();
            const cl = document.getElementById('add-clave').value;

            if(!n || !cl) return alert("Completa los datos");

            db.collection("flota").doc(n).set({
                n_camion: n, chasis: ch, acoplado: ac, clave: cl
            }).then(() => {
                alert("Camión " + n + " Guardado");
                document.querySelectorAll('.grid-formulario input').forEach(i => i.value = "");
            });
        }

        function cargarReportes() {
            db.collection("reportes").orderBy("fecha", "desc").onSnapshot((snapshot) => {
                const tbody = document.getElementById('lista-reportes');
                tbody.innerHTML = "";
                snapshot.forEach((doc) => {
                    const r = doc.data();
                    const id = doc.id;
                    const btnFoto = r.foto ? `<button onclick="imprimirPDF('${r.foto}')" class="btn-pdf">PDF</button>` : "";
                    
                    tbody.innerHTML += `
                        <tr>
                            <td><small>${r.fecha}</small></td>
                            <td style="font-size:18px; text-align:center;"><b>${r.camion}</b></td>
                            <td>
                                <div class="ficha-datos">
                                    <b>Trans:</b> ${r.transporte} | <b>CUIT:</b> ${r.cuit_transporte}<br>
                                    <b>Chofer:</b> ${r.chofer} | <b>CUIT:</b> ${r.cuit_chofer}<br>
                                    <b>Chasis:</b> ${r.chasis} | <b>Acop:</b> ${r.acoplado}
                                </div>
                            </td>
                            <td>
                                <b>Estado:</b> ${r.estado}<br>
                                <b>Destino:</b> ${r.destino}
                            </td>
                            <td>
                                ${btnFoto}
                                <button class="btn-borrar" onclick="borrarRegistro('${id}')">X</button>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        function borrarRegistro(id) {
            if(confirm("¿Eliminar reporte?")) db.collection("reportes").doc(id).delete();
        }

        function imprimirPDF(url) {
            const pwin = window.open("", "_blank");
            pwin.document.write(`<html><body style="margin:0;display:flex;justify-content:center;align-items:center;"><img src="${url}" style="max-width:100%;height:auto;" onload="window.print();"></body></html>`);
            pwin.document.close();
        }
    </script>
</body>
</html>




