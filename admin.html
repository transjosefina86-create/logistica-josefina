<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Control - La Josefina</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background: #ff6600; margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { background: white; padding: 30px; border-radius: 20px; width: 95%; max-width: 1200px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); text-align: center; align-self: flex-start; }
        
        .logo-texto { font-family: 'Brush Script MT', cursive; font-size: 50px; color: #ff6600; text-shadow: 3px 3px 5px rgba(0,0,0,0.3); margin-bottom: 20px; display: block; }
        
        .pantalla-login { max-width: 400px; margin: auto; padding: 20px; }
        input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; border: 2px solid #ddd; font-size: 18px; text-align: center; }
        button { width: 100%; padding: 15px; border-radius: 10px; border: none; background: #222; color: white; font-size: 18px; font-weight: bold; cursor: pointer; }

        .tabla-scroll { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #333; color: white; padding: 15px; text-transform: uppercase; font-size: 12px; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 13px; color: #333; text-align: left; }
        tr:hover { background: #fdf2e9; }

        .btn-pdf { background: #28a745; color: white; padding: 8px 12px; text-decoration: none; border-radius: 6px; font-weight: bold; display: inline-block; font-size: 11px; }
        .oculto { display: none; }
        .tag-estado { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        .cargado { background: #ffe5d9; color: #d9480f; }
        .vacio { background: #e3faf3; color: #087f5b; }
    </style>
</head>
<body>
    <div class="container">
        <span class="logo-texto">Transporte La Josefina</span>

        <div id="login-admin" class="pantalla-login">
            <h2 style="color:#444;">Acceso Administrador</h2>
            <input type="password" id="pass-admin" placeholder="CLAVE DE ACCESO">
            <button onclick="entrarAdmin()">INGRESAR AL PANEL</button>
        </div>

        <div id="panel-datos" class="oculto">
            <h2 style="color:#333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">Panel de Control Logístico</h2>
            <div class="tabla-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Camión</th>
                            <th>Transporte / CUIT</th>
                            <th>Chofer / CUIT</th>
                            <th>Patentes (Ch/Ac)</th>
                            <th>Tipo/Kg</th>
                            <th>Estado</th>
                            <th>Destino</th>
                            <th>Comprobante</th>
                        </tr>
                    </thead>
                    <tbody id="lista-reportes"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC...",
            authDomain: "control-logistica-2026.firebaseapp.com",
            projectId: "control-logistica-2026",
            appId: "1:389274295324:web:04467597157833633e467d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function entrarAdmin() {
            const pass = document.getElementById('pass-admin').value;
            if(pass === "1234") {
                document.getElementById('login-admin').classList.add('oculto');
                document.getElementById('panel-datos').classList.remove('oculto');
                cargarDatos();
            } else {
                alert("Clave incorrecta");
            }
        }

        function cargarDatos() {
            db.collection("reportes").orderBy("fecha", "desc").onSnapshot((snapshot) => {
                const tbody = document.getElementById('lista-reportes');
                tbody.innerHTML = "";
                snapshot.forEach((doc) => {
                    const r = doc.data();
                    const claseEstado = r.estado === 'CARGADO' ? 'cargado' : 'vacio';
                    
                    // Función para abrir imagen y forzar PDF al imprimir
                    const btnFoto = r.foto ? `<a href="javascript:void(0)" onclick="abrirComoPDF('${r.foto}')" class="btn-pdf">VER / PDF</a>` : "---";
                    
                    tbody.innerHTML += `
                        <tr>
                            <td>${r.fecha}</td>
                            <td><strong>#${r.camion}</strong></td>
                            <td>${r.transporte}<br><small>${r.cuit_transporte}</small></td>
                            <td>${r.chofer}<br><small>${r.cuit_chofer}</small></td>
                            <td>${r.chasis}<br>${r.acoplado}</td>
                            <td>${r.tipo}<br>${r.kilos}kg</td>
                            <td><span class="tag-estado ${claseEstado}">${r.estado}</span></td>
                            <td>${r.destino}</td>
                            <td>${btnFoto}</td>
                        </tr>
                    `;
                });
            });
        }

        function abrirComoPDF(url) {
            const win = window.open("", "_blank");
            win.document.write(`
                <html>
                <head><title>Imprimir Comprobante</title></head>
                <body style="margin:0; display:flex; justify-content:center; align-items:center;">
                    <img src="${url}" style="max-width:100%; height:auto;" onload="window.print();">
                </body>
                </html>
            `);
            win.document.close();
        }
    </script>
</body>
</html>


