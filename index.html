<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transporte La Josefina - Choferes</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root { --naranja: #ff6600; --oscuro: #222; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--naranja); margin: 0; padding: 15px; color: var(--oscuro); }
        .card { background: white; padding: 25px; border-radius: 25px; max-width: 450px; margin: auto; box-shadow: 0 15px 35px rgba(0,0,0,0.3); }
        .logo { text-align: center; font-family: 'Brush Script MT', cursive; font-size: 40px; color: var(--naranja); margin-bottom: 20px; }
        
        label { display: block; font-size: 12px; font-weight: bold; margin-top: 15px; color: #666; text-transform: uppercase; }
        input { width: 100%; padding: 14px; margin-top: 5px; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; background: #f9f9f9; }
        input:focus { border-color: var(--naranja); outline: none; background: #fff; }
        
        button { width: 100%; padding: 15px; margin-top: 25px; border-radius: 12px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-ingresar { background: var(--oscuro); color: white; }
        .btn-enviar { background: #27ae60; color: white; }
        .btn-foto { background: #f39c12; color: white; margin-top: 10px; }
        
        .oculto { display: none; }
        .status { font-size: 11px; text-align: center; margin-top: 5px; color: #27ae60; font-weight: bold; }
        .footer-info { text-align: center; font-size: 12px; color: #999; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="card">
        <div class="logo">La Josefina</div>

        <div id="seccion-login">
            <h3 style="text-align:center; margin-top:0;">Ingreso de Chofer</h3>
            <p style="text-align:center; font-size:14px; color:#666;">Coloc√° tu nombre y la clave que te dio el administrador.</p>
            
            <label>Nombre Completo</label>
            <input type="text" id="login-nom" placeholder="Ej: Juan Perez">
            
            <label>Clave de Acceso</label>
            <input type="password" id="login-cla" placeholder="****">
            
            <button class="btn-ingresar" onclick="validarAcceso()">INGRESAR AL SISTEMA</button>
        </div>

        <div id="seccion-reporte" class="oculto">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h4 id="saludo-chofer" style="color:var(--naranja); margin:0;"></h4>
                <button onclick="cerrarSesion()" style="width:auto; padding:5px 10px; margin:0; font-size:10px; background:#eee; color:#333;">SALIR</button>
            </div>

            <label>Transporte / CUIT</label>
            <input type="text" id="transporte" placeholder="Nombre de la Empresa">
            <input type="text" id="cuit_transporte" placeholder="CUIT de la Empresa">

            <label>Patentes (Equipo)</label>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chasis" placeholder="Chasis">
                <input type="text" id="acoplado" placeholder="Acoplado">
            </div>

            <label style="color:var(--naranja); font-size:14px; margin-top:25px;">Datos del Viaje Actual</label>
            
            <label>¬øD√≥nde descargaste?</label>
            <input type="text" id="lugar_descarga" placeholder="Ej: Aceitera, Naca, Planta 1">
            
            <label>Destino y Kilos Netos</label>
            <input type="text" id="destino" placeholder="Hacia d√≥nde vas">
            <input type="number" id="kilos" placeholder="Kilos del comprobante">

            <label>Comprobante / Remito</label>
            <p style="font-size:11px; color:#888; margin:5px 0;">* Us√° el bot√≥n naranja para sacar la foto del papel.</p>
            <button type="button" class="btn-foto" onclick="abrirCamara()">üì∏ SACAR FOTO</button>
            <div id="foto-status" class="status"></div>

            <button id="btn-enviar" class="btn-enviar" onclick="enviarReporte()">ENVIAR REPORTE FINAL</button>
            <p class="footer-info">Al enviar, el estado ser√° "VAC√çO" autom√°ticamente.</p>
        </div>
    </div>

    <script>
        // CONFIGURACI√ìN DE FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyC...",
            authDomain: "control-logistica-2026.firebaseapp.com",
            projectId: "control-logistica-2026",
            appId: "1:389274295324:web:04467597157833633e467d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let nombreSesion = "";

        // Al cargar, vemos si ya hab√≠a datos guardados para no reescribir
        window.onload = function() {
            if(localStorage.getItem('transporte')) {
                document.getElementById('transporte').value = localStorage.getItem('transporte');
                document.getElementById('cuit_transporte').value = localStorage.getItem('cuit_transporte');
                document.getElementById('chasis').value = localStorage.getItem('chasis');
                document.getElementById('acoplado').value = localStorage.getItem('acoplado');
            }
        };

        function validarAcceso() {
            const n = document.getElementById('login-nom').value.trim();
            const c = document.getElementById('login-cla').value.trim();

            if(!n || !c) return alert("Por favor, complet√° los dos campos.");

            db.collection("accesos_choferes").doc(n).get().then(doc => {
                if(doc.exists && doc.data().clave === c) {
                    nombreSesion = n;
                    document.getElementById('saludo-chofer').innerText = "Chofer: " + n;
                    document.getElementById('seccion-login').classList.add('oculto');
                    document.getElementById('seccion-reporte').classList.remove('oculto');
                } else {
                    alert("Acceso Denegado: Nombre o Clave incorrectos.");
                }
            }).catch(e => alert("Error de conexi√≥n: " + e));
        }

        function abrirCamara() {
            // Aqu√≠ va el c√≥digo que ya ten√©s para la API de fotos. 
            // Solo simulamos el aviso de que la foto est√° lista.
            document.getElementById('foto-status').innerText = "‚úÖ FOTO CAPTURADA";
        }

        async function enviarReporte() {
            const btn = document.getElementById('btn-enviar');
            
            // Guardamos datos fijos para la pr√≥xima vez
            localStorage.setItem('transporte', document.getElementById('transporte').value);
            localStorage.setItem('cuit_transporte', document.getElementById('cuit_transporte').value);
            localStorage.setItem('chasis', document.getElementById('chasis').value);
            localStorage.setItem('acoplado', document.getElementById('acoplado').value);

            btn.disabled = true;
            btn.innerText = "ENVIANDO DATOS...";

            const datos = {
                chofer: nombreSesion,
                transporte: document.getElementById('transporte').value,
                cuit_transporte: document.getElementById('cuit_transporte').value,
                chasis: document.getElementById('chasis').value.toUpperCase(),
                acoplado: document.getElementById('acoplado').value.toUpperCase(),
                lugar_descarga: document.getElementById('lugar_descarga').value,
                destino: document.getElementById('destino').value,
                kilos: document.getElementById('kilos').value,
                estado: "VAC√çO",
                fecha: new Date().toLocaleString(),
                // Aqu√≠ la URL que te devuelva tu API de fotos
                foto: "URL_DE_LA_FOTO_AQUI" 
            };

            db.collection("reportes").add(datos).then(() => {
                alert("Reporte enviado con √©xito.");
                // Limpiamos solo lo variable
                document.getElementById('lugar_descarga').value = "";
                document.getElementById('kilos').value = "";
                document.getElementById('foto-status').innerText = "";
                btn.disabled = false;
                btn.innerText = "ENVIAR REPORTE FINAL";
            }).catch(e => {
                alert("Error al enviar: " + e);
                btn.disabled = false;
            });
        }

        function cerrarSesion() {
            location.reload();
        }
    </script>
</body>
</html>





