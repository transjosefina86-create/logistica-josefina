<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>La Josefina - Choferes</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root { --naranja: #ff6600; --gris: #f8f9fa; --texto: #333; }
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: #e9ecef; margin: 0; padding: 10px; 
            display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; 
        }
        .card { 
            background: white; padding: 15px; border-radius: 15px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 360px; 
        }
        h2 { 
            color: var(--naranja); text-align: center; font-size: 18px; 
            margin: 0 0 15px 0; letter-spacing: 1px;
        }
        label { 
            font-size: 10px; font-weight: 700; color: #777; 
            display: block; margin-bottom: 2px; margin-left: 5px; text-transform: uppercase; 
        }
        input, select { 
            width: 100%; padding: 8px 12px; margin-bottom: 8px; border-radius: 8px; 
            border: 1px solid #ddd; box-sizing: border-box; font-size: 13px; color: var(--texto);
        }
        input:focus { border-color: var(--naranja); outline: none; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

        .btn-equipo { 
            display: flex; gap: 5px; margin-bottom: 10px; 
        }
        .btn-eq { 
            flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 8px; 
            background: #fff; font-size: 11px; font-weight: bold; cursor: pointer; color: #666;
        }
        .btn-eq.active { background: #333; color: #fff; border-color: #333; }

        #aviso-foto { 
            display: none; background: #d00; color: white; padding: 10px; 
            border-radius: 10px; margin-bottom: 10px; font-weight: bold; 
            text-align: center; border: 2px solid #ff0; font-size: 12px;
            animation: pulse 1s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .btn-enviar { 
            background: var(--naranja); color: white; font-weight: bold; border: none; 
            width: 100%; padding: 12px; border-radius: 10px; font-size: 16px; 
            cursor: pointer; transition: 0.2s; margin-top: 5px;
        }
        .btn-enviar:active { transform: scale(0.98); }

        #camara-btn { 
            background: #fff; color: var(--naranja); padding: 12px; border-radius: 10px; 
            text-align: center; margin: 8px 0; cursor: pointer; 
            border: 2px dashed var(--naranja); font-weight: bold; font-size: 13px;
        }
        .preview { display: flex; gap: 5px; overflow-x: auto; padding: 2px; }
        .preview img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid var(--naranja); }
        .loader { display: none; text-align: center; color: var(--naranja); font-weight: bold; font-size: 14px; padding: 10px; }
    </style>
</head>
<body>

    <div id="login-box" style="width: 100%; max-width: 320px; margin-top: 30px;">
        <div class="card">
            <h2>LA JOSEFINA</h2>
            <input type="text" id="u-log" placeholder="Usuario">
            <input type="password" id="p-log" placeholder="PIN">
            <button class="btn-enviar" onclick="login()">ENTRAR</button>
        </div>
    </div>

    <div id="form-box" style="display: none; width: 100%; max-width: 360px;">
        <div class="card">
            <div id="aviso-foto">‚ö†Ô∏è FOTO RECHAZADA - SACAR OTRA</div>
            <h2>NUEVO REPORTE</h2>
            
            <label>Transporte / Empresa</label>
            <input type="text" id="f-empresa" oninput="saveM()">

            <label>CUIT Empresa</label>
            <input type="text" id="f-cuit" placeholder="00-00000000-0" oninput="saveM()">

            <label>Nombre del Chofer</label>
            <input type="text" id="f-chof-nom" oninput="saveM()">

            <label>CUIL Chofer</label>
            <input type="text" id="f-chof-cuil" placeholder="00-00000000-0" oninput="saveM()">

            <div class="grid-2">
                <div>
                    <label>Patente Chasis</label>
                    <input type="text" id="f-pat1" oninput="saveM()">
                </div>
                <div>
                    <label>Patente Acoplado</label>
                    <input type="text" id="f-pat2" oninput="saveM()">
                </div>
            </div>

            <label>Tipo de Equipo</label>
            <div class="btn-equipo">
                <button id="eq-c" class="btn-eq active" onclick="setEq('Com√∫n')">COM√öN</button>
                <button id="eq-e" class="btn-eq" onclick="setEq('Escalable')">ESCALABLE</button>
            </div>

            <label>Estado</label>
            <select id="f-estado">
                <option value="VAC√çO">ESTOY VAC√çO</option>
                <option value="CARGADO">ESTOY CARGADO</option>
            </select>
            
            <div id="camara-btn" onclick="document.getElementById('f-file').click()">
                üì∏ SACAR FOTO TICKET
                <input type="file" id="f-file" multiple accept="image/*" capture="camera" style="display: none;" onchange="handleImg()">
            </div>

            <div id="f-prev" class="preview"></div>
            <div id="f-load" class="loader">ENVIANDO...</div>
            <button class="btn-enviar" id="f-btn" onclick="enviar()">ENVIAR REPORTE</button>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyC...", authDomain: "control-logistica-2026.firebaseapp.com", projectId: "control-logistica-2026", appId: "1:389274295324:web:04467597157833633e467d" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let imgsB64 = [];
        let eq = "Com√∫n";
        let uID = "";

        async function login() {
            const u = document.getElementById('u-log').value.toLowerCase();
            const p = document.getElementById('p-log').value;
            const s = await db.collection("accesos_choferes").get();
            s.forEach(doc => {
                if(doc.id.toLowerCase() === u && doc.data().clave === p) {
                    uID = doc.id;
                    document.getElementById('login-box').style.display = 'none';
                    document.getElementById('form-box').style.display = 'block';
                    loadM();
                    radar();
                }
            });
        }

        function radar() {
            db.collection("reportes").where("chofer", "==", uID).onSnapshot(s => {
                let r = false;
                s.forEach(d => { if(d.data().estado === 'CARGADO' && (!d.data().fotos || d.data().fotos.length === 0)) r = true; });
                document.getElementById('aviso-foto').style.display = r ? 'block' : 'none';
            });
        }

        function handleImg() {
            const fs = document.getElementById('f-file').files;
            document.getElementById('aviso-foto').style.display = 'none';
            Array.from(fs).forEach(f => {
                const rd = new FileReader();
                rd.onload = (e) => {
                    const i = new Image(); i.src = e.target.result;
                    i.onload = () => {
                        const cv = document.createElement('canvas'); const cx = cv.getContext('2d');
                        cv.width = 800; cv.height = (i.height * 800) / i.width;
                        cx.drawImage(i, 0, 0, cv.width, cv.height);
                        const b = cv.toDataURL('image/jpeg', 0.6);
                        imgsB64.push(b);
                        const m = document.createElement('img'); m.src = b;
                        document.getElementById('f-prev').appendChild(m);
                    }
                };
                rd.readAsDataURL(f);
            });
        }

        function setEq(t) {
            eq = t;
            document.getElementById('eq-c').className = t === 'Com√∫n' ? 'btn-eq active' : 'btn-eq';
            document.getElementById('eq-e').className = t === 'Escalable' ? 'btn-eq active' : 'btn-eq';
            saveM();
        }

        function saveM() {
            const d = { emp: document.getElementById('f-empresa').value, ct: document.getElementById('f-cuit').value, nom: document.getElementById('f-chof-nom').value, cu: document.getElementById('f-chof-cuil').value, p1: document.getElementById('f-pat1').value, p2: document.getElementById('f-pat2').value, e: eq };
            localStorage.setItem('josefina_m', JSON.stringify(d));
        }

        function loadM() {
            const m = JSON.parse(localStorage.getItem('josefina_m'));
            if(m) {
                document.getElementById('f-empresa').value = m.emp || ""; document.getElementById('f-cuit').value = m.ct || "";
                document.getElementById('f-chof-nom').value = m.nom || ""; document.getElementById('f-chof-cuil').value = m.cu || "";
                document.getElementById('f-pat1').value = m.p1 || ""; document.getElementById('f-pat2').value = m.p2 || "";
                if(m.e) setEq(m.e);
            }
        }

        async function enviar() {
            if(document.getElementById('f-estado').value === 'CARGADO' && imgsB64.length === 0) { alert("Saca la foto"); return; }
            document.getElementById('f-btn').style.display = 'none'; document.getElementById('f-load').style.display = 'block';
            await db.collection("reportes").add({
                chofer: uID, chofer_nombre: document.getElementById('f-chof-nom').value, chofer_cuil: document.getElementById('f-chof-cuil').value,
                transporte: document.getElementById('f-empresa').value, cuit_trans: document.getElementById('f-cuit').value,
                chasis: document.getElementById('f-pat1').value, acoplado: document.getElementById('f-pat2').value,
                equipo: eq, estado: document.getElementById('f-estado').value, fecha: new Date().toLocaleString('es-AR'), fotos: imgsB64
            });
            imgsB64 = []; document.getElementById('f-prev').innerHTML = "";
            document.getElementById('f-btn').style.display = 'block'; document.getElementById('f-load').style.display = 'none';
            alert("ENVIADO");
        }
    </script>
</body>
</html>











































