<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transporte La Josefina</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background: #ff6600; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { background: white; padding: 25px; border-radius: 15px; max-width: 450px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; }
        img.logo { width: 220px; margin-bottom: 20px; }
        
        .campo-grupo { text-align: left; margin-bottom: 12px; }
        label { display: block; font-weight: bold; color: #333; font-size: 14px; margin-bottom: 4px; }
        
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 16px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
        
        /* Solo las patentes en mayúsculas */
        .mayusculas { text-transform: uppercase; }
        
        button { width: 100%; padding: 15px; border-radius: 8px; border: none; background: #333; color: white; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        button:active { transform: scale(0.98); }

        #status { margin-top: 15px; font-weight: bold; color: #ff6600; }
        .oculto { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://logistics-josefina.web.app/logo.png" alt="Logo" class="logo">
        
        <div id="pantalla-clave">
            <input type="password" id="clave" placeholder="N° DE CAMIÓN (CLAVE)">
            <button onclick="verificarClave()">INGRESAR</button>
        </div>

        <div id="formulario" class="oculto">
            <div class="campo-grupo">
                <label>Transporte</label>
                <input type="text" id="transporte">
            </div>

            <div class="campo-grupo">
                <label>CUIT Transporte</label>
                <input type="text" id="cuit_transporte">
            </div>

            <div class="campo-grupo">
                <label>Chofer</label>
                <input type="text" id="chofer">
            </div>

            <div class="campo-grupo">
                <label>CUIT Chofer</label>
                <input type="text" id="cuit_chofer">
            </div>

            <div class="campo-grupo">
                <label>Chasis Patente</label>
                <input type="text" id="chasis" class="mayusculas" placeholder="MAYÚSCULAS">
            </div>

            <div class="campo-grupo">
                <label>Acoplado Patente</label>
                <input type="text" id="acoplado" class="mayusculas" placeholder="MAYÚSCULAS">
            </div>

            <div class="campo-grupo">
                <label>Tipo de Unidad</label>
                <select id="tipo" onchange="toggleKilos()">
                    <option value="COMÚN">COMÚN</option>
                    <option value="ESCALABLE">ESCALABLE</option>
                </select>
            </div>

            <div id="div-kilos" class="campo-grupo oculto">
                <label>Kilogramos</label>
                <input type="number" id="kilos" placeholder="Ingrese kilos">
            </div>

            <div class="campo-grupo">
                <label>Estado</label>
                <select id="estado">
                    <option value="VACÍO">VACÍO</option>
                    <option value="CARGADO">CARGADO</option>
                </select>
            </div>

            <div class="campo-grupo">
                <label>Destino / Cliente</label>
                <input type="text" id="destino" list="destinos-sugeridos" placeholder="Escriba o seleccione">
                <datalist id="destinos-sugeridos"></datalist>
            </div>

            <div class="campo-grupo">
                <label>Foto de Descarga (Opcional)</label>
                <input type="file" id="foto" accept="image/*" capture="camera">
            </div>
            
            <button onclick="enviarReporte()">ENVIAR REPORTE</button>
            <p id="status"></p>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC...", 
            authDomain: "control-logistica-2026.firebaseapp.com",
            projectId: "control-logistica-2026",
            appId: "1:389274295324:web:04467597157833633e467d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function toggleKilos() {
            const tipo = document.getElementById('tipo').value;
            document.getElementById('div-kilos').className = (tipo === 'ESCALABLE') ? 'campo-grupo' : 'campo-grupo oculto';
        }

        function verificarClave() {
            const clave = document.getElementById('clave').value;
            if(clave) {
                // Cargar datos guardados y destinos previos
                const anterior = localStorage.getItem('camion_' + clave);
                if(anterior) {
                    const d = JSON.parse(anterior);
                    document.getElementById('transporte').value = d.transporte || '';
                    document.getElementById('cuit_transporte').value = d.cuit_transporte || '';
                    document.getElementById('chofer').value = d.chofer || '';
                    document.getElementById('cuit_chofer').value = d.cuit_chofer || '';
                    document.getElementById('chasis').value = d.chasis || '';
                    document.getElementById('acoplado').value = d.acoplado || '';
                }
                
                const historialDestinos = JSON.parse(localStorage.getItem('historial_destinos') || '[]');
                const listado = document.getElementById('destinos-sugeridos');
                historialDestinos.forEach(dest => {
                    listado.innerHTML += `<option value="${dest}">`;
                });

                document.getElementById('pantalla-clave').className = 'oculto';
                document.getElementById('formulario').className = '';
            }
        }

        async function enviarReporte() {
            const status = document.getElementById('status');
            const fileInput = document.getElementById('foto');
            const clave = document.getElementById('clave').value;
            status.innerText = "ENVIANDO...";

            let urlImagen = "";
            if (fileInput.files.length > 0) {
                const formData = new FormData();
                formData.append("image", fileInput.files[0]);
                try {
                    const res = await fetch("https://api.imgbb.com/1/upload?key=9caa1af89f65dc79bbae40616bdd0b78", {
                        method: "POST",
                        body: formData
                    });
                    const resData = await res.json();
                    urlImagen = resData.data.url;
                } catch (e) { console.log("Error foto"); }
            }

            const destinoActual = document.getElementById('destino').value.toUpperCase();
            const datos = {
                camion: clave,
                transporte: document.getElementById('transporte').value,
                cuit_transporte: document.getElementById('cuit_transporte').value,
                chofer: document.getElementById('chofer').value,
                cuit_chofer: document.getElementById('cuit_chofer').value,
                chasis: document.getElementById('chasis').value.toUpperCase(),
                acoplado: document.getElementById('acoplado').value.toUpperCase(),
                tipo: document.getElementById('tipo').value,
                kilos: document.getElementById('kilos').value || "0",
                estado: document.getElementById('estado').value,
                destino: destinoActual,
                foto: urlImagen,
                fecha: new Date().toLocaleString()
            };

            // Guardar destino en historial para autocompletar después
            let historial = JSON.parse(localStorage.getItem('historial_destinos') || '[]');
            if(!historial.includes(destinoActual)) {
                historial.push(destinoActual);
                localStorage.setItem('historial_destinos', JSON.stringify(historial));
            }

            localStorage.setItem('camion_' + clave, JSON.stringify(datos));

            db.collection("reportes").add(datos).then(() => {
                status.innerText = "¡ENVIADO!";
                setTimeout(() => location.reload(), 2000);
            }).catch(() => { status.innerText = "Error conexión."; });
        }
    </script>
</body>
</html>


